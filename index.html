<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Llaveros de Banderas</title>

<style>
:root {
  --azul:#2563eb;
  --verde:#16a34a;
  --gris:#f1f5f9;
}

body {
  margin:0;
  font-family:system-ui, sans-serif;
  background:var(--gris);
}

header {
  background:linear-gradient(135deg,var(--azul),#60a5fa);
  color:white;
  padding:30px 20px;
  text-align:center;
}

header img {
  width:260px;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.3);
}

section {
  max-width:1100px;
  margin:40px auto;
  padding:20px;
}

.productos {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:20px;
}

.card {
  background:white;
  padding:20px;
  border-radius:14px;
  box-shadow:0 8px 20px rgba(0,0,0,.12);
  text-align:center;
}

.precio {
  font-size:1.3rem;
  font-weight:bold;
  color:var(--azul);
}

button {
  margin-top:10px;
  padding:10px 16px;
  border:none;
  border-radius:8px;
  background:var(--azul);
  color:white;
  cursor:pointer;
}

#carrito {
  background:white;
  max-width:500px;
  margin:40px auto;
  padding:20px;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.18);
}

.whatsapp {
  display:block;
  margin-top:12px;
  font-weight:bold;
  color:var(--verde);
  text-decoration:none;
  text-align:center;
}

/* ðŸ›’ BOTÃ“N FLOTANTE */
#btn-carrito {
  position:fixed;
  bottom:20px;
  right:20px;
  background:#111827;
  color:white;
  font-size:26px;
  width:60px;
  height:60px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow:0 10px 25px rgba(0,0,0,.3);
}
</style>
</head>

<body>

<header>
  <h1>Llaveros de Banderas</h1>
  <img id="img-principal">
</header>

<section>
  <h2>Llaveros disponibles</h2>
  <div class="productos" id="productos"></div>
</section>

<!-- ðŸ›’ CARRITO -->
<section id="zona-carrito">
  <div id="carrito">
    <h3>Carrito</h3>
    <ul id="lista-carrito"></ul>
    <p><strong>Total:</strong> $<span id="total">0</span></p>
    <button id="ordenar">ORDENAR</button>
    <a class="whatsapp" href="http://wa.me/+59894038105" target="_blank">
      ðŸ“² Contactame
    </a>
  </div>
</section>

<!-- ðŸ›’ BOTÃ“N -->
<div id="btn-carrito">ðŸ›’</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

// ðŸ”´ TUS DATOS
const supabaseUrl = 'https://drabigponnfztvbdxsjc.supabase.co'
const supabaseKey = 'sb_publishable_gHdyPfSabCkNEblGZI8mWg_qMnr4IKb'
const supabase = createClient(supabaseUrl, supabaseKey)

// imagen principal
document.getElementById('img-principal').src =
  supabaseUrl + '/storage/v1/object/public/imagenes/banderas.jpg'

// ðŸ’° precio automÃ¡tico (10â€“50)
function calcularPrecio(peso) {
  const PESO_MIN = 2
  const PESO_MAX = 6
  const PRECIO_MIN = 10
  const PRECIO_MAX = 50

  return Math.round(
    PRECIO_MIN +
    ((peso - PESO_MIN) / (PESO_MAX - PESO_MIN)) *
    (PRECIO_MAX - PRECIO_MIN)
  )
}

// ================== CARGAR PRODUCTOS ==================
const { data: productos, error } = await supabase
  .from('productos')
  .select('*')
  .eq('stock', true)

if (error) {
  alert('Error cargando productos')
  console.error(error)
}

const cont = document.getElementById('productos')
const carrito = []
const lista = document.getElementById('lista-carrito')
const totalSpan = document.getElementById('total')

function renderCarrito() {
  lista.innerHTML = ''
  let total = 0

  carrito.forEach(p => {
    const li = document.createElement('li')
    li.textContent = `${p.productos} - $${p.precio}`
    lista.appendChild(li)
    total += p.precio
  })

  totalSpan.textContent = total
}

productos.forEach(p => {
  const precio = calcularPrecio(p.peso_gramos)

  const div = document.createElement('div')
  div.className = 'card'
  div.innerHTML = `
    <h3>${p.productos}</h3>
    <p>Peso: ${p.peso_gramos} g</p>
    <p class="precio">$${precio}</p>
    <button>Agregar al carrito</button>
  `

  div.querySelector('button').onclick = () => {
    carrito.push({ ...p, precio })
    renderCarrito()
  }

  cont.appendChild(div)
})

// ================== ORDENAR ==================
document.getElementById('ordenar').onclick = async () => {
  if (carrito.length === 0) {
    alert('Carrito vacÃ­o')
    return
  }

  for (const p of carrito) {
    await supabase.from('ordenes').insert({
      producto: p.productos,
      peso_gramos: p.peso_gramos,
      activo: true
    })

    // ðŸ” REEMPLAZA stock (NO agrega columna)
    await supabase
      .from('productos')
      .update({ stock: false })
      .eq('productos', p.productos)
  }

  alert('Pedido registrado. Contactame por WhatsApp.')
  location.reload()
}

// ================== BOTÃ“N CARRITO ==================
document.getElementById('btn-carrito').onclick = () => {
  document.getElementById('zona-carrito')
    .scrollIntoView({ behavior: 'smooth' })
}
</script>

</body>
</html>
