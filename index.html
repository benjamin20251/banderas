<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Llaveros de Banderas</title>

<!-- ========================== ESTILOS ========================== -->
<style>
:root {
  --azul:#2563eb;
  --verde:#16a34a;
  --fondo:#f1f5f9;
}

body {
  margin:0;
  font-family:system-ui, sans-serif;
  background:var(--fondo);
}

/* ===================== HEADER ===================== */
header {
  background:linear-gradient(135deg,var(--azul),#60a5fa);
  color:white;
  text-align:center;
  padding:30px 20px;
}

header h1 {
  margin:0;
  font-size:2.2rem;
}

header p {
  margin-top:5px;
  font-size:1rem;
  opacity:0.9;
}

header img {
  width:260px;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.3);
  margin-top:15px;
}

/* ===================== SECCIONES ===================== */
section {
  max-width:1100px;
  margin:40px auto;
  padding:20px;
}

/* ===================== PRODUCTOS ===================== */
.productos {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
}

.card {
  background:white;
  border-radius:14px;
  padding:20px;
  text-align:center;
  box-shadow:0 8px 20px rgba(0,0,0,.12);
}

.precio {
  font-size:1.3rem;
  font-weight:bold;
  color:var(--azul);
}

button {
  padding:10px 16px;
  border:none;
  border-radius:8px;
  background:var(--azul);
  color:white;
  cursor:pointer;
  margin-top:10px;
  font-weight:bold;
  transition:0.2s;
}

button:hover {
  background:#1e40af;
}

/* ===================== CARRITO ===================== */
#carrito-box {
  background:white;
  max-width:500px;
  margin:40px auto;
  padding:20px;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.2);
}

#carrito-box h3 {
  margin-top:0;
}

#lista-carrito {
  list-style:none;
  padding-left:0;
}

#lista-carrito li {
  padding:5px 0;
  border-bottom:1px solid #eee;
}

/* ===================== BOTÃ“N CARRITO ===================== */
#btn-carrito {
  position:fixed;
  bottom:20px;
  right:20px;
  width:60px;
  height:60px;
  border-radius:50%;
  background:#111827;
  color:white;
  font-size:26px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow:0 10px 25px rgba(0,0,0,.35);
}

/* ===================== WHATSAPP ===================== */
.whatsapp {
  display:block;
  margin-top:15px;
  text-align:center;
  font-weight:bold;
  color:var(--verde);
  text-decoration:none;
}

/* ===================== PERSONALIZADOS ===================== */
#personalizados {
  background:white;
  max-width:600px;
  margin:40px auto;
  padding:20px;
  border-radius:14px;
  box-shadow:0 8px 20px rgba(0,0,0,.15);
  text-align:center;
}

#estadoPersonalizada {
  margin-top:10px;
  font-weight:bold;
  color:var(--azul);
}
</style>
</head>

<body>

<!-- ===================== HEADER ===================== -->
<header>
  <h1>Llaveros de Banderas</h1>
  <p>Venta en efectivo Â· Entrega personal</p>
  <img id="img-principal">
</header>

<!-- ===================== PRODUCTOS ===================== -->
<section>
  <h2>Productos disponibles</h2>
  <div class="productos" id="productos"></div>
</section>

<!-- ===================== PERSONALIZADOS ===================== -->
<section id="personalizados">
  <h2>ðŸ”§ Llaveros Personalizados</h2>
  <p>SubÃ­ tu imagen, coordinamos el pago y lo hago a pedido. Precio desde $100</p>
  <input type="file" id="imgPersonalizada" accept="image/*"><br><br>
  <button id="enviarPersonalizada">Enviar diseÃ±o</button>
  <p id="estadoPersonalizada"></p>
</section>

<!-- ===================== CARRITO ===================== -->
<section id="zona-carrito">
  <div id="carrito-box">
    <h3>ðŸ›’ Carrito</h3>
    <ul id="lista-carrito"></ul>
    <p><strong>Total:</strong> $<span id="total">0</span></p>
    <button id="ordenar">ORDENAR</button>
    <a class="whatsapp" href="https://wa.me/59894038105" target="_blank">ðŸ“² Contactame</a>
  </div>
</section>

<!-- ===================== BOTÃ“N CARRITO ===================== -->
<div id="btn-carrito">ðŸ›’</div>

<!-- ===================== SCRIPT PRINCIPAL ===================== -->
<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

// ðŸ”´ REEMPLAZÃ ESTO CON TUS DATOS REALES
const supabaseUrl = 'https://drabigponnfztvbdxsjc.supabase.co'
const supabaseKey = 'sb_publishable_gHdyPfSabCkNEblGZI8mWg_qMnr4IKb'
const supabase = createClient(supabaseUrl, supabaseKey)

// ===================== IMAGEN PRINCIPAL =====================
document.getElementById('img-principal').src =
  supabaseUrl + '/storage/v1/object/public/imagenes/banderas.jpg'

// ===================== FUNCIÃ“N PRECIO FIJO =====================
function calcularPrecio(nombreProducto) {
  const caros = ['uruguay','argentina','brasil']
  if(caros.includes(nombreProducto.toLowerCase())) return 100
  return 50
}

// ===================== VARIABLES =====================
const cont = document.getElementById('productos')
const carrito = []
const lista = document.getElementById('lista-carrito')
const totalSpan = document.getElementById('total')

// ===================== RENDER CARRITO =====================
function renderCarrito() {
  lista.innerHTML = ''
  let total = 0
  carrito.forEach(p=>{
    const li=document.createElement('li')
    li.textContent=`${p.productos} - $${p.precio}`
    lista.appendChild(li)
    total+=p.precio
  })
  totalSpan.textContent=total
}

// ===================== CARGAR PRODUCTOS =====================
const { data: productos, error } = await supabase
  .from('productos')
  .select('*')
  .eq('stock', true)

if(error || !productos){
  console.error(error)
  cont.innerHTML='<p>Error cargando productos</p>'
} else {
  productos.forEach(p=>{
    const precio = calcularPrecio(p.productos)
    const card=document.createElement('div')
    card.className='card'
    card.innerHTML=`
      <h3>${p.productos}</h3>
      <p>${p.peso_gramos} g</p>
      <p class="precio">$${precio}</p>
      <button>Agregar al carrito</button>
    `
    card.querySelector('button').onclick=()=>{
      carrito.push({...p,precio})
      renderCarrito()
    }
    cont.appendChild(card)
  })
}

// ===================== ORDENAR =====================
document.getElementById('ordenar').onclick=async()=>{
  if(!carrito.length){ alert('Carrito vacÃ­o'); return }

  for(const p of carrito){
    await supabase.from('ordenes').insert({
      producto:p.productos,
      peso_gramos:p.peso_gramos,
      activo:true
    })
    await supabase.from('productos')
      .update({stock:false})
      .eq('productos',p.productos)
  }
  alert('Pedido registrado. Contactame por WhatsApp.')
  location.reload()
}

// ===================== BOTÃ“N CARRITO =====================
document.getElementById('btn-carrito').onclick=()=>{
  document.getElementById('zona-carrito').scrollIntoView({behavior:'smooth'})
}

// ===================== PERSONALIZADOS =====================
document.getElementById('enviarPersonalizada').onclick=async()=>{
  const file=document.getElementById('imgPersonalizada').files[0]
  if(!file){ alert('SubÃ­ una imagen primero'); return }

  const nombre = Date.now()+'-'+file.name

  const { error: uploadError } = await supabase
    .storage.from('personalizados').upload(nombre,file)

  if(uploadError){
    console.error(uploadError)
    alert('Error subiendo imagen')
    return
  }

  await supabase.from('ordenes_personalizadas').insert({
    imagen:nombre,
    activo:true
  })

  document.getElementById('estadoPersonalizada').textContent=
    'âœ… DiseÃ±o enviado. Contactame por WhatsApp para coordinar.'
}
</script>

<!-- ===================== VERCEL ANALYTICS ===================== -->
<script>
window.va=window.va||function(){(window.vaq=window.vaq||[]).push(arguments)}
</script>
<script defer src="/_vercel/analytics/script.js"></script>

</body>
</html>
